<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>문의 등록/수정</title>
    <link rel="stylesheet" href="/styles.css" />
</head>
<body>
<div class="page">
    <header class="header">
        <div class="brand">Request Builder</div>
        <nav class="nav">
            <a class="button secondary" href="/dashboard">대시보드</a>
            <a class="button secondary" href="/supports">문의 관리</a>
            <a class="button secondary" href="/users" th:if="${isAdmin}">담당자 관리</a>
            <form action="/logout" method="post" style="display:inline;">
                <button class="button secondary" type="submit">로그아웃</button>
            </form>
        </nav>
    </header>

    <main class="container">
        <section class="card">
            <div class="section-title" th:text="${ticket.id == null} ? '문의 등록' : '문의 수정'"></div>
            <p class="alert error" th:if="${error}" th:text="${error}"></p>
            <form class="form-grid" th:action="${ticket.id == null} ? @{/supports} : @{/supports/{id}(id=${ticket.id})}"
                  method="post" enctype="multipart/form-data">
                <div class="field">
                    <label>문의 제목</label>
                    <input type="text" name="title" th:value="${ticket.title}" required />
                </div>
                <div class="field">
                    <label>문의 내용</label>
                    <textarea name="content" rows="6" th:text="${ticket.content}" required></textarea>
                </div>
                <div class="field">
                    <label>문의 유형</label>
                    <select name="inquiryType">
                        <option value="" th:selected="${ticket.inquiryType == null}">선택하세요</option>
                        <option th:each="t : ${inquiryTypes}" th:value="${t}" th:text="${t}" th:selected="${ticket.inquiryType == t}"></option>
                    </select>
                </div>
                <div class="field">
                    <label>카테고리</label>
                    <select name="category">
                        <option value="" th:selected="${ticket.category == null}">선택하세요</option>
                        <option th:each="c : ${categories}" th:value="${c}" th:text="${c}" th:selected="${ticket.category == c}"></option>
                    </select>
                </div>
                <div class="field">
                    <label>우선순위</label>
                    <select name="priority">
                        <option th:each="p : ${T(com.example.dailyreport.domain.TicketPriority).values()}" th:value="${p}" th:text="${p}" th:selected="${ticket.priority == p}"></option>
                    </select>
                </div>
                <div class="field">
                    <label>담당자</label>
                    <select name="userId" required>
                        <option value="" disabled th:selected="${ticket.user == null}">선택하세요</option>
                        <option th:each="u : ${users}"
                                th:value="${u.id}"
                                th:text="${u.name + ' (' + u.email + ')'}"
                                th:selected="${ticket.user != null ? u.id == ticket.user.id : (currentUser != null and u.id == currentUser.id)}">
                        </option>
                    </select>
                </div>
                <div class="field" th:if="${ticket.id == null}">
                    <label>첨부 파일</label>
                    <input type="file" name="files" multiple />
                </div>
                <div class="actions">
                    <button class="button" type="submit">저장</button>
                    <a class="button secondary" href="/supports">목록</a>
                </div>
            </form>
        </section>
    </main>
</div>
</body>
</html>
